(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7420a1fc"],{a718:function(t,i,s){"use strict";s.r(i);var e=function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",[s("audio",{attrs:{id:"gplayer",crossOrigin:"anonymous",autoplay:"autoplay"},on:{timeupdate:t.player_timeupdate,ended:t.player_next,error:t.player_next}}),s("p",{staticClass:"player-title text-ellipsis text-secondary mb-1 c-hand",on:{click:function(i){return t.init()}}},[s("transition",[s("span",{key:t.lyric,class:{"tooltip tooltip-right":!t.ready},attrs:{"data-tooltip":t.config.tooltip},domProps:{textContent:t._s(t.lyric)}})]),s("span",{staticClass:"text-light"},[t._v("dplayer")])],1),s("div",{staticClass:"modal modal-sm player_ui",class:{active:t.show}},[s("a",{staticClass:"modal-overlay",attrs:{href:"javascript:void(0)"},on:{click:function(i){t.show=0}}}),s("div",{staticClass:"modal-container"},[s("div",{staticClass:"modal-header pb-1 px-2"},[s("a",{staticClass:"btn btn-clear float-right",attrs:{href:"javascript:void(0)"},on:{click:function(i){t.show=0}}}),s("div",{staticClass:"modal-title h5 text-ellipsis",attrs:{title:t.title},domProps:{textContent:t._s(t.title)}})]),s("div",{staticClass:"modal-body px-2"},[s("div",{staticClass:"content"},[s("div",{staticClass:"text-gray text-ellipsis"},[s("transition",[s("span",{key:t.lyric,domProps:{textContent:t._s(t.lyric)}})]),s("span",{staticClass:"text-light"},[t._v("dplayer")])],1),s("canvas",{staticClass:"img-responsive",style:{"background-image":"url("+t.pic+")"},attrs:{id:"gplayer_spectrum",width:"304",height:"150"}}),s("div",{staticClass:"bar bar-sm mt-2"},[s("div",{staticClass:"bar-item tooltip",style:{width:100*t.currentTime/t.duration+"%"},attrs:{"data-tooltip":t.parsetime}})])])]),s("div",{staticClass:"modal-footer px-2"},[s("div",{staticClass:"btn-group btn-group-block"},[s("button",{staticClass:"btn",on:{click:t.player_prev}},[t._v("上一曲")]),s("button",{staticClass:"btn",class:{"btn-primary":!t.isplaying},on:{click:t.btn_switch}},[t._v(" "+t._s(t.isplaying?"暂停":"播放")+" ")]),s("button",{staticClass:"btn",on:{click:t.player_next}},[t._v("下一曲")]),s("button",{staticClass:"btn",on:{click:function(i){t.showlist=1,t.show=0}}},[t._v(" 列表 ")])])])])]),s("div",{staticClass:"toast-container"},[s("transition",[t.toast?s("div",{key:t.toast,staticClass:"toast toast-primary"},[s("button",{staticClass:"btn btn-clear float-right",on:{click:function(i){t.toast=""}}}),t._v(t._s(t.toast)+" ")]):t._e()])],1),s("div",{staticClass:"modal modal-sm",class:{active:t.showlist}},[s("a",{staticClass:"modal-overlay",attrs:{href:"javascript:void(0)"},on:{click:function(i){t.showlist=0,t.show=1}}}),s("div",{staticClass:"modal-container"},[s("div",{staticClass:"modal-header px-2 pb-1"},[s("a",{staticClass:"btn btn-clear float-right",attrs:{href:"javascript:void(0)"},on:{click:function(i){t.showlist=0,t.show=1}}}),s("div",{staticClass:"modal-title h5 text-ellipsis",domProps:{textContent:t._s(t.isplaying?"正在播放：#"+(1*t.current+1)+" "+t.title:"播放列表")}})]),s("div",{staticClass:"modal-body px-2 pt-1",staticStyle:{"-webkit-overflow-scrolling":"touch","max-height":"300px"}},[s("div",{staticClass:"content"},[s("table",{staticClass:"table table-striped table-hover"},[t._m(0),s("tbody",t._l(t.list,(function(i,e){return s("tr",{key:i[0],staticClass:"c-hand",class:{"active text-bold":e==t.current},on:{click:function(i){return t.player_play(e)}}},[s("td",[t._v(t._s(e+1))]),s("td",{staticClass:"tooltip",attrs:{"data-tooltip":(e==t.current?"当前播放：":"点击播放：")+"\n"+i[1]},domProps:{textContent:t._s(i[1])}})])})),0)])])])])])])},a=[function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("thead",{staticClass:"list-header"},[s("tr",[s("th",[t._v("#")]),s("th",[t._v("歌曲名称")])])])}],r={name:"Gplayer",props:["config"],data(){return{isinit:0,show:0,api:"https://api.imjad.cn/cloudmusic/",logo:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Zz48dGl0bGU+TGF5ZXIgMTwvdGl0bGU+PHRleHQgc3Ryb2tlPSIjMDAwIiBmaWxsPSIjMDAwIiBzdHJva2Utd2lkdGg9IjAiIHg9IjE1MCIgeT0iOTUiIGZvbnQtc2l6ZT0iNzAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIHhtbDpzcGFjZT0icHJlc2VydmUiPkdibG9nPC90ZXh0PjwvZz48L3N2Zz4=",ready:0,current:-1,isplaying:0,player:null,canvas:null,lrc:[],lyric:this.config.subtitle,currlrc:0,currentTime:0,duration:1,pic:"about:blank",list:[],title:"Gplayer",toast:"",showlist:0,spectrum:{height:300,canvas_width:304,canvas_height:148,ctx:null,analyser:null,gradient:null,meter_num:null,meter_width:10,gap:1,cap_height:2,cap_color:"#fff",cap_y_position:[],from_color:"rgba(255,255,255,0)",to_color:"#fff"}}},computed:{parsetime(){let t=Math.floor(this.currentTime/60),i=Math.floor(this.currentTime%60);return(t<10?"0"+t:t)+":"+(i<10?"0"+i:i)}},methods:{async api_comon(t){return(await fetch(t)).json()},api_list(t){return this.api_comon(this.api+"?type=playlist&id="+t+"&_="+Date.now())},api_song(t){return this.api_comon(this.api+"?type=song&id="+t)},api_lrc(t){return this.api_comon(this.api+"?type=lyric&id="+t)},api_detail(t){return this.api_comon(this.api+"?type=detail&id="+t)},async player_play(t){if(t=t||0,t!=this.current){this.lyric=this.subtitle,this.current=t,window.localStorage.index=this.current;let i=this.list[t][0];this.lrc=[],this.pic=this.logo;let s=await this.api_song(i);200==s.code?(this.player.src=s.data[0].url,await this.player.play(),this.player_play_succeed()):(this.list.splice(t,1),this.list.length>0?this.player_next():this.ready=0);let e=await this.api_lrc(i);e&&!e.nolyric&&e.lrc.lyric.split("\n").forEach(t=>{let i=/(?:\[\d+:\d+\.\d+\])+(.*)/g.exec(t);i&&t.match(/\[\d+:\d+.\d+\]/g).forEach(t=>{t=/\[(\d+):(\d+)\.(\d+)\]/.exec(t),this.lrc[60*t[1]+1*t[2]]=i[1]})});let a=await this.api_detail(i);200==a.code&&(this.pic=a.songs[0].al.picUrl)}else await this.player.play(),this.player_play_succeed()},player_play_succeed(){this.isplaying=1;let t=this.list[this.current][1];this.title=t,this.lyric=t,this.player.currentTime<3&&(this.toast=t)},player_pause(){this.player.pause(),this.lyric=this.subtitle,this.isplaying=0},player_prev(){let t=this.current-1;this.player_play(t<0?this.list.length-1:t)},player_next(){let t=1*this.current+1;this.player_play(t>=this.list.length?0:t)},player_timeupdate(){let t=Math.floor(this.player.currentTime);this.currentTime=t,this.duration=this.player.duration,this.lrc.length&&t!=this.currlrc&&(this.currlrc=t,this.lrc[t]&&(this.lyric=this.lrc[t])),3==t&&(this.toast="")},btn_switch(){this.isplaying?this.player_pause():this.player_play(window.localStorage.index||0)},async init(){if(!this.isinit){this.isinit=1,this.pic=this.logo,this.lyric=this.config.subtitle;let t=await this.api_list(this.config.id).catch(()=>this.config.tooltip="音乐接口繁忙，都是我不好...");if(200==t.code){for(let i of t.playlist.tracks)this.list.push([i.id,i.name]);t.playlist.trackCount>0&&(this.pic=this.logo,this.ready=1,this.$nextTick(()=>{this.player=document.querySelector("#gplayer"),this.canvas=document.querySelector("#gplayer_spectrum");let t=window.localStorage.index||0;t>=this.list.length&&(t=0),this.player_play(t),/Android|iP(hone|ad|od)/i.test(navigator.userAgent)||this.spectrum_init()}))}}this.show=1},spectrum_init(){let t=this.canvas;this.spectrum.meter_num=this.spectrum.canvas_width/(this.spectrum.meter_width+this.spectrum.gap),this.spectrum.ctx=t.getContext("2d"),window.AudioContext=window.AudioContext||window.webkitAudioContext;let i=new AudioContext;this.spectrum.analyser=i.createAnalyser(),i.createMediaElementSource(this.player).connect(this.spectrum.analyser),this.spectrum.analyser.connect(i.destination),this.spectrum.gradient=this.spectrum.ctx.createLinearGradient(0,0,0,this.spectrum.canvas_height),this.spectrum.gradient.addColorStop(0,this.spectrum.from_color),this.spectrum.gradient.addColorStop(1,this.spectrum.to_color),this.spectrum_renderFrame()},spectrum_renderFrame(){this.spectrum.ctx.clearRect(0,0,this.spectrum.canvas_width,this.spectrum.canvas_height+this.spectrum.cap_height);let t=new Uint8Array(this.spectrum.analyser.frequencyBinCount);this.spectrum.analyser.getByteFrequencyData(t);let i=Math.round(.7*t.length/this.spectrum.meter_num);this.spectrum.ctx.clearRect(0,0,this.spectrum.cwidth,this.spectrum.canvas_height);for(let s=0;s<this.spectrum.meter_num;s++){let e=t[s*i]*this.spectrum.canvas_height/this.spectrum.height;this.spectrum.cap_y_position.length<Math.round(this.spectrum.meter_num)&&this.spectrum.cap_y_position.push(e),this.spectrum.ctx.fillStyle=this.spectrum.cap_color,e<this.spectrum.cap_y_position[s]?this.spectrum.ctx.fillRect(s*(this.spectrum.meter_width+this.spectrum.gap),this.spectrum.canvas_height- --this.spectrum.cap_y_position[s],this.spectrum.meter_width,this.spectrum.cap_height):(this.spectrum.ctx.fillRect(s*(this.spectrum.meter_width+this.spectrum.gap),this.spectrum.canvas_height-e,this.spectrum.meter_width,this.spectrum.cap_height),this.spectrum.cap_y_position[s]=e),this.spectrum.ctx.fillStyle=this.spectrum.gradient,this.spectrum.ctx.fillRect(s*(this.spectrum.meter_width+this.spectrum.gap),this.spectrum.canvas_height-e+this.spectrum.cap_height,this.spectrum.meter_width,this.spectrum.canvas_height)}requestAnimationFrame(this.spectrum_renderFrame)}}},c=r,l=(s("b7d0"),s("2877")),n=Object(l["a"])(c,e,a,!1,null,null,null);i["default"]=n.exports},ad1e:function(t,i,s){},b7d0:function(t,i,s){"use strict";var e=s("ad1e"),a=s.n(e);a.a}}]);